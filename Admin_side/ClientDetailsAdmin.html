<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Couriers - Courier Tracking System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            width: 250px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .logo-sidebar {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }
        .sidebar-nav .nav-link.active {
            background-color: #f0f0f0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<div class="d-flex">
    <!-- Sidebar -->
    <div class="sidebar bg-white shadow-sm">
        <div class="sidebar-header p-4 border-bottom">
            <div class="d-flex align-items-center">
                <div class="logo-sidebar me-3">
                    <i class="fas fa-box text-white"></i>
                </div>
                <div class="d-block">
                    <h5 class="mb-0 fw-bold">Courier Tracking System</h5>
                    <small class="text-muted">Admin Panel</small>
                </div>
            </div>
        </div>
        <nav class="sidebar-nav p-3 flex-grow-1">
                <a href="AdminDashboard .html" class="nav-link mb-2">
                <i class="fas fa-th-large me-3"></i>
                <span class="d-inline">Dashboard</span>
            </a>
            <a href="CourierTracking .html" class="nav-link mb-2">
                <i class="fas fa-truck me-3"></i>
                <span class="d-inline">Manage Couriers</span>
            </a>
            <a href="ClientDetailsAdmin.html" class="nav-link active mb-2">
                <i class="fas fa-users me-3"></i>
                <span class="d-inline">Manage Clients</span>
            </a>
            <a href="Report and Setting-Admin.html" class="nav-link mb-2">
                <i class="fas fa-file-alt me-3"></i>
                <span class="d-inline">Reports & Settings</span>
            </a>
            <a href="History Client.html" class="nav-link mb-2">
                <i class="fas fa-history me-3"></i>
                <span class="d-inline">History</span>
            </a>
        </nav>
        <div class="sidebar-footer p-3 border-top mt-auto">
            <div class="d-block mb-3">
                <div class="d-flex align-items-center">
                    <div class="user-avatar me-3">A</div>
                    <div>
                        <div class="fw-medium">Admin</div>
                        <small class="text-muted">Admin</small>
                    </div>
                </div>
            </div>
            <button class="btn btn-outline-danger btn-sm w-100" onclick="logout()">
                <i class="fas fa-sign-out-alt me-2"></i>
                <span class="d-inline">Logout</span>
            </button>
        </div>
    </div>

        <!-- Main Content -->
        <div class="main-content flex-fill">
            <!-- Header -->
            <div class="content-header bg-white border-bottom p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="fw-bold mb-1">Manage Clients</h2>
                        <p class="text-muted mb-0">View and manage registered clients and their courier history</p>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="fas fa-users me-2 text-muted"></i>
                        <span class="text-muted">Total Clients: <span id="clientCount">4</span></span>
                    </div>
                </div>
            </div>

            <!-- Search -->
            <div class="bg-white border-bottom p-4">
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" class="form-control" id="clientSearchInput" placeholder="Search clients by name, email, or phone...">
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="content-body p-4">
                <div class="card">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Client Details</th>
                                    <th>Contact</th>
                                    <th>Orders</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="clientTableBody">
                                <tr>
                                    <td>
                                        <div class="fw-bold">Rajesh Sharma</div>
                                        <div class="text-muted small">Rajesh Logistics Pvt Ltd — Mumbai, Maharashtra</div>
                                    </td>
                                    <td>
                                        <div>rajesh.sharma@example.in</div>
                                        <div class="text-muted small">+91 98200 12345</div>
                                    </td>
                                    <td>34</td>
                                    <td><span class="badge bg-success">Active</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-primary btn-view-client" 
                                            data-name="Rajesh Sharma" data-email="rajesh.sharma@example.in" data-phone="+91 98200 12345" data-city="Mumbai, Maharashtra" data-orders="34">
                                            <i class="fas fa-eye me-1"></i>View
                                        </button>
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        <div class="fw-bold">Priya Patel</div>
                                        <div class="text-muted small">Patel Enterprises — Ahmedabad, Gujarat</div>
                                    </td>
                                    <td>
                                        <div>priya.patel@example.in</div>
                                        <div class="text-muted small">+91 98765 43210</div>
                                    </td>
                                    <td>21</td>
                                    <td><span class="badge bg-success">Active</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-primary btn-view-client" 
                                            data-name="Priya Patel" data-email="priya.patel@example.in" data-phone="+91 98765 43210" data-city="Ahmedabad, Gujarat" data-orders="21">
                                            <i class="fas fa-eye me-1"></i>View
                                        </button>
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        <div class="fw-bold">Amit Kumar</div>
                                        <div class="text-muted small">BlueLine Couriers — New Delhi, Delhi</div>
                                    </td>
                                    <td>
                                        <div>amit.kumar@example.in</div>
                                        <div class="text-muted small">+91 99887 66554</div>
                                    </td>
                                    <td>12</td>
                                    <td><span class="badge bg-warning text-dark">Inactive</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-primary btn-view-client" 
                                            data-name="Amit Kumar" data-email="amit.kumar@example.in" data-phone="+91 99887 66554" data-city="New Delhi, Delhi" data-orders="12">
                                            <i class="fas fa-eye me-1"></i>View
                                        </button>
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        <div class="fw-bold">Sneha Reddy</div>
                                        <div class="text-muted small">Reddy Retailers — Hyderabad, Telangana</div>
                                    </td>
                                    <td>
                                        <div>sneha.reddy@example.in</div>
                                        <div class="text-muted small">+91 90909 12345</div>
                                    </td>
                                    <td>48</td>
                                    <td><span class="badge bg-success">Active</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-primary btn-view-client" 
                                            data-name="Sneha Reddy" data-email="sneha.reddy@example.in" data-phone="+91 90909 12345" data-city="Hyderabad, Telangana" data-orders="48">
                                            <i class="fas fa-eye me-1"></i>View
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Client History Modal -->
    <div class="modal fade" id="historyModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h5 class="modal-title">Courier History - <span id="clientName"></span></h5>
                        <small class="text-muted" id="clientEmail"></small>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="historyContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/script.js"></script>
    <!-- Load admin-specific helpers (provides logout() and courier helpers) -->
    <script src="js/admin-script.js"></script>
    <script>
        // Wire up client view buttons, search filtering, and client count
        (function () {
            // Update the client count to reflect currently visible rows
            function updateClientCount() {
                const tbody = document.getElementById('clientTableBody');
                const countEl = document.getElementById('clientCount');
                const rows = tbody ? Array.from(tbody.querySelectorAll('tr')) : [];
                const visibleRows = rows.filter(r => r.style.display !== 'none');
                if (countEl) countEl.textContent = visibleRows.length;
            }

            function attachViewHandlers() {
                const buttons = document.querySelectorAll('.btn-view-client');
                buttons.forEach(btn => {
                    btn.addEventListener('click', function () {
                        const name = this.dataset.name || '';
                        const email = this.dataset.email || '';
                        const phone = this.dataset.phone || '';
                        const city = this.dataset.city || '';
                        const orders = this.dataset.orders || '';

                        const clientNameEl = document.getElementById('clientName');
                        const clientEmailEl = document.getElementById('clientEmail');
                        const historyContent = document.getElementById('historyContent');

                        if (clientNameEl) clientNameEl.textContent = name;
                        if (clientEmailEl) clientEmailEl.textContent = email + ' • ' + phone;

                        if (historyContent) {
                            // Simple placeholder history
                            historyContent.innerHTML = `
                                <p><strong>Company / Location:</strong> ${city}</p>
                                <p><strong>Total Orders:</strong> ${orders}</p>
                                <hr>
                                <p class="mb-1"><strong>Recent Shipments</strong></p>
                                <ul>
                                    <li>#${Math.floor(Math.random()*9000)+1000} — Delivered</li>
                                    <li>#${Math.floor(Math.random()*9000)+1000} — In Transit</li>
                                    <li>#${Math.floor(Math.random()*9000)+1000} — Pending</li>
                                </ul>
                            `;
                        }

                        // Show modal (Bootstrap 5)
                        const modalEl = document.getElementById('historyModal');
                        if (modalEl) {
                            const modal = new bootstrap.Modal(modalEl);
                            modal.show();
                        }
                    });
                });
            }

            // Attach live search to filter client table rows
            function attachSearchHandler() {
                const input = document.getElementById('clientSearchInput');
                const tbody = document.getElementById('clientTableBody');
                if (!input || !tbody) return;

                input.addEventListener('input', function () {
                    const q = input.value.trim().toLowerCase();
                    const rows = Array.from(tbody.querySelectorAll('tr'));

                    rows.forEach(row => {
                        // Combine the important columns' text and normalize whitespace
                        const text = row.textContent.replace(/\s+/g, ' ').toLowerCase();
                        if (!q || text.indexOf(q) !== -1) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });

                    updateClientCount();
                });
            }

            // Initialize on DOM ready
            document.addEventListener('DOMContentLoaded', function () {
                updateClientCount();
                attachViewHandlers();
                attachSearchHandler();
            });
        })();
    </script>
</body>
</html>
